---
import { experience } from '../content/data/experience';
---
<div class="grid gap-6 sm:gap-8">
  <!-- Company Selector with Enhanced Mobile Styling -->
  <div class="overflow-x-auto md:overflow-x-visible">
    <div class="flex gap-3 sm:gap-4 min-w-max md:min-w-0 px-1 py-2 justify-center">
      {experience.map((e,i)=>
        <button 
          class="company-btn relative group transition-all duration-300 bg-white/60 dark:bg-white/5 hover:bg-white/80 dark:hover:bg-white/10 border border-gray-200/60 dark:border-white/10 hover:border-brand-red/30 rounded-xl sm:rounded-2xl px-3 sm:px-5 py-2 sm:py-3 font-semibold hover:shadow-lg hover:shadow-brand-red/10 active:scale-95 whitespace-nowrap flex-shrink-0 flex items-center gap-2"
          data-company={i}
          onclick={`showExperience(${i})`}
        >
          <span class="text-xs sm:text-sm font-bold">{e.company}</span>
          
          <!-- Tooltip - Hidden on mobile -->
          <div class="company-tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-72 sm:w-80 p-4 sm:p-5 bg-gray-900 dark:bg-white rounded-xl shadow-2xl border border-gray-700 dark:border-gray-200 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-all duration-300 z-50 hidden md:block">
            <div class="mb-3 text-center">
              <h4 class="font-bold text-lg text-white dark:text-gray-900 mb-1">{e.company}</h4>
            </div>
            <div class="flex flex-col gap-2 text-sm text-gray-300 dark:text-gray-600">
              <div class="flex items-center justify-center gap-2">
                <iconify-icon icon="solar:users-group-rounded-outline" class="w-4 h-4 text-brand-red flex-shrink-0"></iconify-icon>
                <span>{e.employees} employees</span>
              </div>
              <div class="flex items-center justify-center gap-2">
                <iconify-icon icon="solar:case-outline" class="w-4 h-4 text-brand-red flex-shrink-0"></iconify-icon>
                <span>{e.industry}</span>
              </div>
            </div>
            <!-- Tooltip arrow -->
            <div class="absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900 dark:border-t-white"></div>
          </div>
        </button>
      )}
    </div>
  </div>

  <!-- Experience Cards with Enhanced Mobile Styling -->
  <div class="relative">
    {experience.map((e,i)=>
      <div class={`exp-card transition-all duration-500 ${i>0?'hidden':''}`} data-index={i}>
        <div class="glass rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 border border-white/20 hover:border-brand-red/20 transition-all duration-300 hover:shadow-2xl hover:shadow-brand-red/5">
          <!-- Header with Company Info -->
          <div class="flex flex-col sm:flex-row items-start gap-4 sm:justify-between mb-4 sm:mb-6">
            <div class="flex items-center gap-3 sm:gap-4">
              <div class="w-12 h-12 sm:w-16 sm:h-16 rounded-xl sm:rounded-2xl bg-gradient-to-br from-brand-red/10 to-brand-red/5 flex items-center justify-center text-xs sm:text-sm font-bold border border-brand-red/20 text-brand-red flex-shrink-0">
                {e.company.substring(0, 2).toUpperCase()}
              </div>
              <div class="min-w-0">
                <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-gray-900 dark:text-white leading-tight">{e.role}</h3>
                <p class="text-base sm:text-lg font-medium text-brand-red">{e.company}</p>
                <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">{e.industry} â€¢ {e.employees} employees</p>
              </div>
            </div>
            <div class="w-full sm:w-auto">
              <span class="inline-block w-full sm:w-auto text-center px-3 sm:px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-700">
                {e.date}
              </span>
            </div>
          </div>

          <!-- Company Description -->
          {e.description && (
            <div class="mb-4 sm:mb-6">
              <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400 leading-relaxed bg-gray-50 dark:bg-gray-800/50 rounded-xl p-3 sm:p-4 border border-gray-200 dark:border-gray-700 break-words">
                {e.description}
              </p>
            </div>
          )}

          <!-- Key Achievements -->
          <div class="mb-4 sm:mb-6">
            <h4 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4 flex items-center gap-2">
              <iconify-icon icon="solar:medal-star-outline" class="w-4 h-4 sm:w-5 sm:h-5 text-brand-red"></iconify-icon>
              Key Achievements
            </h4>
            <ul class="space-y-2 sm:space-y-3">
              {e.bullets.map(b=>
                <li class="flex items-start gap-2 sm:gap-3 text-sm sm:text-base text-gray-700 dark:text-gray-300">
                  <iconify-icon icon="solar:check-circle-outline" class="w-4 h-4 sm:w-5 sm:h-5 text-green-500 mt-0.5 flex-shrink-0"></iconify-icon>
                  <span class="leading-relaxed">{b}</span>
                </li>
              )}
            </ul>
          </div>

          <!-- Technologies -->
          <div>
            <h4 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4 flex items-center gap-2">
              <iconify-icon icon="solar:code-outline" class="w-4 h-4 sm:w-5 sm:h-5 text-brand-red"></iconify-icon>
              Technologies & Tools
            </h4>
            <div class="flex flex-wrap gap-2">
              {e.tags.map(t=>
                <span class="px-2 sm:px-3 py-1 bg-gradient-to-r from-gray-100 to-gray-50 dark:from-gray-800 dark:to-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs sm:text-sm font-medium border border-gray-200 dark:border-gray-600 hover:border-brand-red/30 transition-colors">
                  {t}
                </span>
              )}
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
</div>

<script>
  let currentExperience = 0;

  function showExperience(index) {
    // Hide all cards
    document.querySelectorAll('.exp-card').forEach((card) => {
      card.classList.add('hidden');
    });
    
    // Show selected card
    const selectedCard = document.querySelector(`[data-index="${index}"]`);
    if (selectedCard) {
      selectedCard.classList.remove('hidden');
    }
    
    // Update button states
    document.querySelectorAll('.company-btn').forEach((btn, i) => {
      // Reset all buttons to inactive state
      btn.classList.remove('bg-brand-red', 'text-white', 'border-brand-red');
      btn.classList.add('bg-white/60', 'dark:bg-white/5', 'border-gray-200/60', 'dark:border-white/10');
      
      // Set active button
      if (i === index) {
        btn.classList.remove('bg-white/60', 'dark:bg-white/5', 'border-gray-200/60', 'dark:border-white/10');
        btn.classList.add('bg-brand-red', 'text-white', 'border-brand-red');
      }
    });
    
    currentExperience = index;
  }

  // Initialize first company as active
  window.addEventListener('DOMContentLoaded', () => {
    showExperience(0);
  });

  // Make function globally available
  window.showExperience = showExperience;
</script>

<style>
  /* Tooltip optimization */
  .company-tooltip {
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
  }
  
  /* Smooth tooltip appearance */
  .company-btn:hover .company-tooltip {
    animation: tooltipFadeIn 0.2s ease-out;
  }
  
  @keyframes tooltipFadeIn {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(5px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }
  
  /* Line clamp fallback for older browsers */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
